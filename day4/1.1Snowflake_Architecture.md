# **Snowflake Architecture**
![alt text](image-14.png)
Snowflake’s architecture is built on a **multi-cluster, shared data** approach, enabling scalability, performance, and separation of compute from storage. It consists of three main layers:

---

## **1. Storage Layer**
**Definition:** Snowflake stores data in a **Hybrid Columnar Format** in cloud object storage (blobs), rather than traditional row-based storage.

**Purpose:** Optimized for compression, performance, and analytical queries.

**Key Points:**
- Immutable storage — every change creates a new version.
- Fully managed by Snowflake, no manual tuning needed.
- Scales independently from compute.

---

## **2. Query Processing Layer**
**Also Known As:** The **muscle** of the system.

**Purpose:** Executes queries using **Massive Parallel Processing (MPP)**.

**Features:**
- Dedicated **Virtual Warehouses** for workloads.
- Independent compute clusters for concurrent processing.
- Scalable compute capacity without impacting other workloads.

---

## **3. Cloud Services Layer**
**Also Known As:** The **brain** of the system.

**Purpose:** Coordinates and manages the entire Snowflake service.

**Responsibilities:**
- Authentication and access control.
- Query optimization.
- Metadata management.
- Infrastructure management and monitoring.

---

## **Warehouse Sizes**
| Size  | cluster (server) |
|-------|------------------|
| **XS** | 1  |
| **S**  | 2  |
| **M**  | 4  |
| **L**  | 8  |
| **XL** | 16 |
| **4XL**| 128|

---

## **Multi-Clustering**
- Used to handle **concurrent workloads**.
- Automatically adds clusters when query load increases.

**Example:**
```
More Queries → Additional Servers
```

---

# **Warehouse in Snowflake**

**Definition:** A compute resource in Snowflake used to process queries, load data, and perform other operations.

**Key Points:**
- Warehouses are billed based on size and active time.
- Can be configured to auto-suspend and auto-resume.

---

## **How to Create a Warehouse Using SQL**

**Basic Syntax:**
```sql
CREATE WAREHOUSE my_warehouse
WITH
  WAREHOUSE_SIZE = 'XSMALL'
  WAREHOUSE_TYPE = 'STANDARD'
  AUTO_SUSPEND = 300
  AUTO_RESUME = TRUE
  INITIALLY_SUSPENDED = TRUE
  COMMENT='This is Second Warehouse';
```

**Parameter Description:**

| Parameter               | Description |
|-------------------------|-------------|
| **WAREHOUSE_SIZE**      | Size (`XSMALL`, `SMALL`, `MEDIUM`, `LARGE`, `XLARGE`, etc.) |
| **WAREHOUSE_TYPE**      | `STANDARD` (default) or `SNOWPARK-OPTIMIZED` |
| **AUTO_SUSPEND**        | Time in seconds before suspension (e.g., `300` = 5 min) |
| **AUTO_RESUME**         | Automatically resumes on query execution |
| **INITIALLY_SUSPENDED** | Starts warehouse in suspended state |

---

### **Example Command**
```sql
CREATE WAREHOUSE sales_wh
WITH
  WAREHOUSE_SIZE = 'SMALL'
  AUTO_SUSPEND = 120
  AUTO_RESUME = TRUE
  INITIALLY_SUSPENDED = TRUE;
```

### **Create Only if Not Exists**
```sql
CREATE WAREHOUSE IF NOT EXISTS sales_wh
WITH
  WAREHOUSE_SIZE = 'SMALL'
  AUTO_SUSPEND = 120
  AUTO_RESUME = TRUE
  INITIALLY_SUSPENDED = TRUE;
```

**Check Existing Warehouses:**
```sql
SHOW WAREHOUSES;
```

---

# **Alter Warehouse**
- Allows modification of size, suspension settings, and other parameters.

---

# **Drop Warehouse**

**Basic Syntax:**
```sql
DROP WAREHOUSE warehouse_name;
```

**Example:**
```sql
DROP WAREHOUSE sales_wh;
```
- Removes compute resource, but **does not delete data**.

**Drop Only if Exists:**
```sql
DROP WAREHOUSE IF EXISTS sales_wh;
```

**Best Practices:**
- Use `IF EXISTS` in automation.
- Ensure warehouse is suspended before dropping.
- Always check existing warehouses:
```sql
SHOW WAREHOUSES;
```
